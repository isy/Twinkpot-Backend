<div id="app">
  <side-menu></side-menu>
  <div class="contents">
    <%= render 'content_header' %>
    <section class="post-section">
      <h2 class="post-title">æ–°è¦æŠ•ç¨¿â˜ºï¸</h2>
      <%= form_for(@post, :url => photo_create_home_index_path) do |f| %>
        <p class="section-title">å†™çœŸ<i class="fa fa-camera-retro" aria-hidden="true"></i><span class="form-required">å¿…é ˆ</span></p>
        <div class="uploader">
          <div class="image">
            <i class="fa fa-upload"></i>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
          </div>
          <%= f.file_field :post_image, id: 'selfile', class: 'file-input', placeholder: 'ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰', 'v-on:change': 'onFileChange' %>
        </div>
        <div id="canvas" v-show="uploadedImage">
          <p class="section-title"> ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</p>
          <img :src="uploadedImage" id="image" />
          <i id="edit-button" class="fa fa-pencil edit-icon" aria-hidden="true"></i>
          <p>â€»å³ä¸‹ã®ã‚¢ã‚¤ã‚³ãƒ³ã§ç”»åƒã‚’ç·¨é›†ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™</p>
        </div>
        <p class="section-title">ä½ç½®æƒ…å ±<i class="fa fa-location-arrow" aria-hidden="true"></i></p>
        <vue-google-autocomplete
          id="map"
          types="establishment"
          classname="google-autocomplete-input"
          placeholder="å ´æ‰€ã‚’å…±æœ‰ã—ã‚ˆã†ğŸ™ˆ"
          v-on:placechanged="getAddressData"
          country="jp"
          name=""
        >
        </vue-google-autocomplete>
        <%= f.hidden_field :place_id, ':value': 'address.place_id' %>
        <%= f.hidden_field :place_name, ':value': 'address.name' %>
        <%= f.hidden_field :remote_post_image_url, id:'image_src', value: '' %>
        <p class="section-title">ã‚«ãƒ†ã‚´ãƒª<i class="fa fa-heart" aria-hidden="true"></i><span class="form-required">å¿…é ˆ</span></p>
        <%= f.collection_select :category_id, @categories, :id, :name %>
        <p class="section-title">ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³<i class="fa fa-comment-o" aria-hidden="true"></i></p>
        <%= f.text_area :caption, class: 'form-caption', placeholder: 'å†™çœŸã®èª¬æ˜ã‚’æ›¸ã“ã†ğŸ¥' %>
        <%= f.submit 'æŠ•ç¨¿ğŸ“·', class: 'post-button' %>
      <% end %>
      <div class="message is-success" v-show="address">
        <div class="message-body">{{ address }}</div>
      </div>
    </section>
    <%= render 'content_footer' %>
  </div>
</div>


<%= javascript_pack_tag 'post' %>

<script type="text/javascript">
    //Adobeã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–¢æ•°
    function set_adbe_image(){
        //<body>å†…ã®ç”»åƒè¦ç´ ã‚’å–å¾—
        var button = document.getElementById('edit-button');
        var image = document.getElementById('image');
        //ç”»åƒç·¨é›†ã‚¨ãƒ‡ã‚£ã‚¿ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®æº–å‚™
        var Editor = new Aviary.Feather({
            apiKey: '8c2b5b3559be493786442e92aba0f0d0',
            language: 'ja',
            onSave: function(imageID, newURL) {
                document.getElementById("image").src = newURL;
                document.getElementById("image_src").value = newURL;
                Editor.close();
            }
        });
        //ç”»åƒè¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã€ã€Œç·¨é›†ã‚¨ãƒ‡ã‚£ã‚¿ã€ã‚’è¡¨ç¤º
        button.addEventListener('click', function () {
            Editor.launch({
                //<img>å†…ã®idã¨srcã‚’å–å¾—
                image: image.id,
                url: image.src
            });
        });
    }
    //ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼å‹•ä½œå‰²ã‚Šå½“ã¦ã‚‹
    set_adbe_image();
    //ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒœãƒƒã‚¯ã‚¹ã®å‡¦ç†
    var obj1 = document.getElementById("selfile");
    obj1.addEventListener("change", function(evt){
        var file = evt.target.files;
        var reader = new FileReader();
        //dataURLå½¢å¼ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
        reader.readAsDataURL(file[0]);
        //ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­è¾¼ãŒçµ‚äº†ã—ãŸæ™‚ã®å‡¦ç†
        reader.onload = function(){
            var dataUrl = reader.result;
            //èª­ã¿è¾¼ã‚“ã ç”»åƒã¨dataURLã‚’æ›¸ãå‡ºã™
//            document.getElementById("canvas").innerHTML = "<img id='image' class='oppai' src='" + dataUrl + "'>";
//            set_adbe_image();
        }
    },false);
</script>
